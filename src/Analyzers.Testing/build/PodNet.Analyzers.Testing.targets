<Project>
	
	<Target Name="PreparePackNuGetToTest" BeforeTargets="PackNuGetToTest">
		<ItemGroup>
			<AutoPackBeforeReferenceProjectReference Include="@(ProjectReference)" Condition="'%(ProjectReference.AutoPackBeforeReference)' == 'true'" />
		</ItemGroup>
	</Target>

	<Target Name="PackNuGetToTest" BeforeTargets="Restore;CollectPackageReferences" Condition="'@(AutoPackBeforeReferenceProjectReference)' != ''">
		<PropertyGroup>
			<RestoreAdditionalProjectSources Condition="'$(RestoreAdditionalProjectSources)' == ''">$(ArtifactsPath)\package</RestoreAdditionalProjectSources>
		</PropertyGroup>
		<MakeDir Directories="$(RestoreAdditionalProjectSources)" />
		<MSBuild Projects="@(AutoPackBeforeReferenceProjectReference)" Targets="Pack" />
	</Target>
	
</Project>